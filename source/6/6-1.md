# C++こと始め
　この章では，`C`の構造体をより拡張して使いやすくした「クラス」という`C++`の機能について触れていきます．

## 冗長な関数名
　ベクトル演算を行うライブラリを作ってもらいました．雰囲気としては，以下のようなコードを書いたはずです．

```C
typedef struct{
　	double x;
　	double y;
　	double z;
}Vector;　	

int addVector(Vector _a, Vector _b, Vector *out);
int subVector(Vector _a, Vector _b, Vector *out);

```

そこで考えてほしいのは関数名に何度も`Vector`と書くのは冗長ではないかということです．  
さらっと自分のコードも見直してみましょう．

わざわざ`Vector.h`のようなわかりやすいヘッダファイルに分けて書いたのですから，そこにある`add`や`sub`はベクトルに関連する関数のはずです．（もし，ファイルを分けて作っていないのなら，ちゃんと分けておきましょう）

単純な問題ですが，`C`で解決するには力不足です．これを機に`C++`の学習を始めましょう．
とはいっても細かな文法は，既存の本を参考にしてください．

# クラス
## 概要
構造体を学習するとき，「関連のある変数をまとめる」という説明をしました．  
クラスは「関連のある変数だけでなく，関数をまとめる」ことができます．

上記のコードをクラスで書いてみると，以下のようなコードになります．

```C++
class Vector{
	private:
		double x;
		double y;
		double z;
	
	public:
		Vector(double x, double y, double z);
		~Vector();
		
		int add(Vector &b);
		int sub(Vector &b);
}
```
クラス内にある変数は**メンバ変数**，クラス内にある関数を**メンバ関数**または**メソッド**と呼ぶことがあります．  
以後，この教材でもメンバ変数，メンバ関数と呼称します．

この章では，C言語の例を示して，それをC++ではこのように改善するという方法を示すスタンスで進めていきます．

## プログラマの義務
　インターネットに関連した勉強をするときには，「悪意のある人間」がいることを前提に暗号化技術があり，指紋認証があるというような話をされます．  
　これはプログラムにおいても同じです．悪意があるかどうかだけでなく，ただの不注意も防止する必要があります．  
「参照渡し」の話で渡されたポインタが`NULL`であるかエラーチェックしましたね？その話の応用です．

## C言語で「安全」な構造体 ?
　以前，「ファイルから座標を読み込み，構造体に格納する」というプログラムを書きましたね？  
しかし，みなさんの提出プログラムでは，**安全が保障されていない**部分があります． 

それは，構造体に直接値を代入してしまうような場合です．  
（完全なコードではないですが）具体的には以下のようなコードが**書けてしまうことです**．

```C
	 Vector *vec = (Vector*)malloc(sizeof(Vector)* num);
	 
	 /*
	 	ファイルから構造体に値を入力する処理
	 */
	 
	 vec.x = 1;
	 vec.y = 2;
	 ...
```

できることなら，ファイルから入力した値はプログラムが終了するまで変わって欲しくありません．  
何度も計算に利用する可能性があるためです．  
これを防ぐ目的で，構造体に１つフラグを増やしてみましょうか．

```C
typedef struct{
　	double x;
　	double y;
　	double z;
　	int is_lock; //追加
}Vector;　	

//追加
void set_x(Vector* _vec, double _x){
	if( _vec.is_lock == true){
		return;
	}
	else{
		_vec.x = _x;
		_vec.is_lock = true;
	}
};

```

上記のような`set_x()`や`is_lock`を定義すれば，`Vector`に値を入力するとき，つまりファイルから値を入力するときに使えば，あとから値を書き換えられなくなります．　　

### ...とは言い切れません

もしあなたの書いたコードが

- 他人に利用される
- 利用する人は`set_x()`を知らない

という条件を満たしたとき，このコードは安全ではなくなります．    
普通に`_vec.x = 1;`のようにアクセスできてしまうからです．また，`is_lock`自体は好きに変えることができてしまうので，そもそも`set_x()`いらなくね？という話になってしまいます．  

加えて，上記のコードには制約があります．

- 構造体`Vector`を初期化する際に`is_lock`を必ず`false`にしなければならない．
- 構造体内の変数を書き換える際には，`set_`と名のつく関数を通して行なわければならない．
	- 直接，構造体内の変数をいじってはいけない

上記であげた制約はプログラマーの努力目標であって，別にしなくても Visual Studioさんには怒られません．このような**コンパイルエラーにならないバグ**は除去に相当な時間を割く場合があります．

### 小まとめ
　C言語の仕組みでは，`_vec.x = 1;`のようなコードを直接禁止することができないため，危険なプログラムが生まれる可能性がある．

## C++で「安全」なクラス
...編集中

## ルール
クラスを作るときには，決まった作法があります．
**それは，メンバ変数を外からアクセスできないようにすることです．**  
クラス内の`private:`という構文がありますね．この構文によって，クラスの外からはメンバ変数へのアクセスを禁止します．


### [目次に戻る](../../README.md)
